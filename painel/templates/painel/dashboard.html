{% extends 'painel/base.html' %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Dashboard</h2>
    <h3 class="mb-4">Bem-vindo(a), {{ request.user.get_full_name|default:request.user.username }}!</h3>
    
    {% if request.user.tipo == 'cliente' %}
        
        <div class="row mb-5">
            <div class="col-md-4">
                <div class="card p-3 shadow-sm border-0 h-100">
                    <h5 class="card-title text-muted">Total de Agendamentos Futuros</h5>
                    <p class="display-4 text-primary">{{ total_futuros|default:0 }}</p>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card p-3 shadow-sm border-0 h-100">
                    <h5 class="card-title text-muted">Próximo Agendamento</h5>
                    {% if proximo_agendamento %}
                        <p class="card-text">
                            <strong>{{ proximo_agendamento.servico.nome }}</strong><br>
                            {{ proximo_agendamento.data_horario|date:"d/m/Y H:i" }}
                        </p>
                    {% else %}
                        <p class="card-text text-muted">Nenhum registro encontrado.</p>
                    {% endif %}
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card p-3 shadow bg-primary text-white border-0 h-100 d-flex flex-column justify-content-center align-items-center">
                    <h4 class="card-title">Novo Agendamento</h4>
                    <a href="{% url 'agendamentos:criar_agendamento' %}" class="btn btn-light mt-2">Agendar Agora</a>
                </div>
            </div>
        </div>
        
        <h4 class="mb-3">Nossos Serviços Disponíveis</h4>
        <div class="row mb-5">
            {% for servico in servicos_disponiveis %}
            <div class="col-md-4 mb-4">
                <div class="card p-3 h-100 shadow-sm">
                    <h5 class="card-title text-success">{{ servico.nome }}</h5>
                    <p class="card-text m-0">Duração: {{ servico.duracao }} minutos</p>
                    <p class="card-text">Preço: R$ {{ servico.preco|floatformat:2 }}</p>
                    <div class="mt-auto">
                        <a href="{% url 'agendamentos:criar_agendamento' %}?servico={{ servico.pk }}" class="btn btn-sm btn-outline-success w-100">Agendar Este Serviço</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12"><div class="alert alert-info">Nenhum serviço cadastrado.</div></div>
            {% endfor %}
        </div>
        
        <h4 class="mb-3">Próximos Agendamentos</h4>
        {% if proximos_agendamentos %}
            <a href="{% url 'agendamentos:listar' %}" class="btn btn-secondary btn-sm mb-3">Ver Todos os Detalhes</a>
        {% else %}
            <div class="alert alert-info">Você não possui agendamentos futuros. Agende um serviço agora!</div>
        {% endif %}

    {% elif request.user.tipo == 'profissional' or request.user.is_staff %}
        <p class="mb-4">Painel de Administração e Gestão de Agendamentos</p>

        <div class="row mb-5">
            <div class="col-md-4">
                <div class="card p-3 shadow-sm bg-primary text-white border-0 h-100">
                    <h4 class="card-title">Agendamentos Hoje</h4>
                    <p class="display-4">{{ agendamentos_hoje_count }}</p>
                    <a href="{% url 'agendamentos:agenda' %}" class="btn btn-light mt-2">Ver Agenda Completa</a>
                </div>
            </div>
        </div>

        <h4 class="mb-3">Próximos Agendamentos (Hoje)</h4>
       {% for agendamento in agendamentos_hoje_list %}
    <tr>
        <td>{{ agendamento.data_horario|date:"H:i" }}</td>
        <td>{{ agendamento.usuario.get_full_name }}</td>
        <td>{{ agendamento.servico.nome }}</td>
    </tr>
{% empty %}
    <div class="alert alert-success">Nenhum agendamento ativo para hoje.</div>
{% endfor %}

    {% endif %}
    
</div>
{% endblock %}